# Homework Assistant

## Overview

This is a full-stack web application that provides AI-powered homework assistance. The application allows users to submit text, images, PDFs, and documents, then processes them using various Large Language Model (LLM) providers to generate detailed solutions. The system features drag-and-drop file uploads, voice input capabilities, mathematical notation rendering, and PDF export functionality.

## System Architecture

The application follows a full-stack architecture with clear separation between client and server:

### Frontend (React + TypeScript)
- **Framework**: React 18 with TypeScript
- **Build Tool**: Vite for fast development and optimized builds
- **UI Framework**: Shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with custom design tokens
- **State Management**: TanStack Query for server state management
- **Routing**: Wouter for lightweight client-side routing
- **Math Rendering**: MathJax for mathematical notation display
- **Graph Display**: Integrated image display for auto-generated graphs

### Backend (Node.js + Express)
- **Runtime**: Node.js with TypeScript
- **Framework**: Express.js for API routes
- **Database**: PostgreSQL with Drizzle ORM
- **File Processing**: Multer for file uploads with support for PDFs, images, and documents
- **OCR**: Tesseract.js for image text extraction
- **PDF Processing**: pdf2json for PDF text extraction
- **Graph Generation**: Chart.js with ChartJSNodeCanvas for automatic graph creation

### Database Schema
- **Primary Entity**: `assignments` table storing:
  - Input text and file metadata
  - Processing results and LLM responses
  - Auto-generated graph data and images
  - Provider information and processing times
  - Creation timestamps

## Key Components

### File Processing Pipeline
1. **File Upload**: Drag-and-drop or file picker interface
2. **Text Extraction**: 
   - Images: OCR using Tesseract.js
   - PDFs: Text extraction using pdf2json
   - Documents: Direct text processing
3. **LLM Processing**: Integration with multiple AI providers
4. **Graph Detection & Generation**: Automatic detection of graph requirements and creation
5. **Response Generation**: Formatted solutions with math notation and embedded graphs

### Integrated Graph Generation System
- **Automatic Detection**: Smart detection of homework assignments requiring graphs/plots
- **LLM Integration**: AI providers generate graph data alongside solutions
- **Chart Creation**: Server-side graph generation using Chart.js and Canvas
- **Frontend Display**: Seamless integration of graphs within solution presentations
- **Supported Types**: Line charts, bar charts, and scatter plots
- **Data Sources**: Scientifically accurate data generated by AI based on assignment context

### LLM Integration
- **Anthropic Claude**: Primary AI provider for text processing
- **OpenAI GPT**: Alternative provider option
- **Azure OpenAI**: Enterprise-grade OpenAI integration
- **Provider Selection**: User-selectable AI model choice

### Voice Input System
- **Speech Recognition**: Browser-based Web Speech API
- **Azure Speech Services**: Enhanced speech-to-text capabilities
- **Real-time Transcription**: Live voice input with interim results

### Mathematical Notation
- **MathJax Integration**: Automatic rendering of mathematical expressions
- **LaTeX Support**: Full LaTeX mathematical notation support
- **Print Optimization**: Specialized formatting for PDF generation

## Data Flow

1. **Input Processing**:
   - User submits text or uploads files
   - Files are processed for text extraction
   - Content is validated and analyzed for graph requirements

2. **AI Processing**:
   - Extracted text is sent to selected LLM provider with graph detection
   - AI generates detailed solution with step-by-step explanations
   - If graphs are required, AI also provides structured graph data
   - Response and graph data are processed and stored

3. **Graph Generation** (when required):
   - Graph data is extracted from AI response
   - Chart.js generates professional graphs on server
   - Graph images are encoded and stored alongside solutions

4. **Output Generation**:
   - Solutions are rendered with mathematical notation
   - Generated graphs are displayed above text solutions
   - Content is formatted for display and export with integrated graphs
   - Users can edit, save, or export complete solutions

## External Dependencies

### Core Dependencies
- **Database**: PostgreSQL (configured via DATABASE_URL)
- **LLM APIs**: Anthropic, OpenAI, Azure OpenAI (API keys required)
- **CDN Services**: MathJax, Google Fonts
- **Speech Services**: Azure Cognitive Services (optional)

### Development Dependencies
- **Build Tools**: Vite, ESBuild, TypeScript compiler
- **Linting**: ESLint with TypeScript support
- **CSS Processing**: PostCSS with Tailwind CSS

## Deployment Strategy

### Build Process
1. **Frontend Build**: Vite builds React application to `dist/public`
2. **Backend Build**: ESBuild bundles server code to `dist/index.js`
3. **Database Migration**: Drizzle applies schema changes
4. **Static Assets**: Client assets served from server

### Environment Configuration
- **Development**: Local development with hot reloading
- **Production**: Optimized builds with environment-specific configurations
- **Database**: Automated provisioning via Replit PostgreSQL

### Hosting Requirements
- **Node.js Runtime**: Version 20+ required
- **PostgreSQL Database**: Persistent storage for assignments
- **External API Access**: Outbound connections for LLM providers
- **File Upload Support**: Temporary file storage for processing

## Changelog

- June 17, 2025. Initial setup
- June 17, 2025. Integrated automatic graph generation for homework assignments requiring visual components
- June 17, 2025. Implemented dual-download PDF system: separate graph PDF and solution PDF when graphs are generated
- June 17, 2025. **COMPLETED**: Dual-download PDF system fully functional - automatically downloads both graph PDF and solution PDF with embedded graph
- June 17, 2025. Removed AI detection interface to maximize solution viewing space
- June 17, 2025. **COMPLETED**: Multi-graph protocol for assignments requiring multiple graphs with 1+n PDF structure
- June 17, 2025. Updated database schema to support multiple graphs using arrays (graphImages, graphData arrays)
- June 17, 2025. Modified all LLM processing functions to detect and generate multiple graphs per assignment
- June 17, 2025. Implemented PDF combining functionality for 1+n document structure (n graph documents + 1 solution document)
- June 17, 2025. Updated frontend to display all graphs before main text content according to multi-graph protocol
- June 18, 2025. Multi-graph protocol tested and confirmed working - successfully generates and combines multiple graph PDFs
- June 19, 2025. Enhanced chat interface with larger input area, improved styling, and better user experience for lengthy conversations
- June 27, 2025. **COMPLETED**: Math View Toggle - Added prominent toggle button in solution window allowing users to switch between Math View (rendered notation) and Edit View (raw text) with distinct visual styling
- July 2, 2025. **COMPLETED**: PDF Math Rendering Fix - Extended MathJax rendering time to 5 seconds, added proper promise handling, visual loading indicator, and improved CSS styling for perfect mathematical notation in PDF exports

## User Preferences

Preferred communication style: Simple, everyday language.